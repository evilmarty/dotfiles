#!/bin/bash

set -e

main() {
  local branch="master"

  while [[ $# -ne 0 ]]; do
    case "$1" in
      -b|--branch)
        local branch="$2"
        shift
        ;;
      --fail)
        fail_if_branch_is "$branch"
        ;;
      --confirm)
        ask_to_continue_if_branch_is "$branch"
        ;;
    esac
    shift
  done
}

git_branch() {
  git rev-parse --abbrev-ref HEAD
}

fail_if_branch_is() {
  if [ "$1" == $(git_branch) ]; then
    exit 1
  fi
}

ask_to_continue_if_branch_is() {
  local branch=$(git_branch)

  if [ "$1" != "$branch" ]; then
    return 0
  fi

  read -p "You are on $branch branch, do you wish to continue? " choice
  case "$choice" in
    y|Y ) ;;
    * ) exit 1 ;;
  esac
}

main "$@"
